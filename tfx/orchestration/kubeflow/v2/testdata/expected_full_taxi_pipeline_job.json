{
  "displayName":"my-pipeline",
  "pipelineSpec":{
    "pipelineInfo":{
      "name":"full-taxi-pipeline"
    },
    "schemaVersion":"1.0.0",
    "sdkVersion":"0.26.0.dev",
    "tasks":[
      {
        "taskInfo":{
          "name":"CsvExampleGen"
        },
        "cachingOptions":{

        },
        "inputs":{
          "parameters":{
            "output_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"split_config\": {\n    \"splits\": [\n      {\n        \"hash_buckets\": 2,\n        \"name\": \"train\"\n      },\n      {\n        \"hash_buckets\": 1,\n        \"name\": \"eval\"\n      }\n    ]\n  }\n}"
                }
              }
            },
            "input_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"splits\": [\n    {\n      \"name\": \"single_split\",\n      \"pattern\": \"*\"\n    }\n  ]\n}"
                }
              }
            },
            "output_data_format":{
              "runtimeValue":{
                "constantValue":{
                  "intValue":"6"
                }
              }
            },
            "input_base":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"path/to/my/data"
                }
              }
            }
          }
        },
        "outputs":{
          "artifacts":{
            "examples":{
              "artifactType":{
                "instanceSchema":"title: tfx.Examples\ntype: object\nproperties:\n  span:\n    type: int\n    description: Span for an artifact.\n  version:\n    type: int\n    description: Version for an artifact.\n  split_names:\n    type: string\n    description: JSON-encoded list of splits for an artifact. Empty string means artifact has no split.\n"
              }
            }
          }
        },
        "executorLabel":"CsvExampleGen_executor"
      },
      {
        "taskInfo":{
          "name":"Resolver.latest_blessed_model_resolver-model-blessing-resolver"
        },
        "outputs":{
          "artifacts":{
            "model_blessing":{
              "artifactType":{
                "instanceSchema":"title: tfx.ModelBlessing\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "executorLabel":"Resolver.latest_blessed_model_resolver-model-blessing-resolver_executor"
      },
      {
        "outputs":{
          "artifacts":{
            "model":{
              "artifactType":{
                "instanceSchema":"title: tfx.Model\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "executorLabel":"Resolver.latest_blessed_model_resolver-model-resolver_executor",
        "taskInfo":{
          "name":"Resolver.latest_blessed_model_resolver-model-resolver"
        },
        "inputs":{
          "artifacts":{
            "input":{
              "outputArtifactKey":"model_blessing",
              "producerTask":"Resolver.latest_blessed_model_resolver-model-blessing-resolver"
            }
          }
        }
      },
      {
        "inputs":{
          "parameters":{
            "source_uri":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{}"
                }
              }
            },
            "resolver_class":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\"__class__\": \"LatestArtifactsResolver\", \"__module__\": \"tfx.dsl.experimental.latest_artifacts_resolver\", \"__tfx_object_type__\": \"class\"}"
                }
              }
            }
          }
        },
        "outputs":{
          "artifacts":{
            "model":{
              "artifactType":{
                "instanceSchema":"title: tfx.Model\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "taskInfo":{
          "name":"Resolver.latest_model_resolver"
        },
        "executorLabel":"Resolver.latest_model_resolver_executor"
      },
      {
        "dependentTasks":[
          "CsvExampleGen"
        ],
        "inputs":{
          "parameters":{
            "exclude_splits":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"[]"
                }
              }
            }
          },
          "artifacts":{
            "examples":{
              "outputArtifactKey":"examples",
              "producerTask":"CsvExampleGen"
            }
          }
        },
        "executorLabel":"StatisticsGen_executor",
        "cachingOptions":{

        },
        "outputs":{
          "artifacts":{
            "statistics":{
              "artifactType":{
                "instanceSchema":"title: tfx.ExampleStatistics\ntype: object\nproperties:\n  span:\n    type: int\n    description: Span for an artifact.\n  split_names:\n    type: string\n    description: JSON-encoded list of splits for an artifact. Empty string means artifact has no split.\n"
              }
            }
          }
        },
        "taskInfo":{
          "name":"StatisticsGen"
        }
      },
      {
        "taskInfo":{
          "name":"SchemaGen"
        },
        "executorLabel":"SchemaGen_executor",
        "dependentTasks":[
          "StatisticsGen"
        ],
        "inputs":{
          "parameters":{
            "infer_feature_shape":{
              "runtimeValue":{
                "constantValue":{
                  "intValue":"0"
                }
              }
            },
            "exclude_splits":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"[]"
                }
              }
            }
          },
          "artifacts":{
            "statistics":{
              "producerTask":"StatisticsGen",
              "outputArtifactKey":"statistics"
            }
          }
        },
        "outputs":{
          "artifacts":{
            "schema":{
              "artifactType":{
                "instanceSchema":"title: tfx.Schema\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "cachingOptions":{

        }
      },
      {
        "executorLabel":"ExampleValidator_executor",
        "dependentTasks":[
          "SchemaGen",
          "StatisticsGen"
        ],
        "taskInfo":{
          "name":"ExampleValidator"
        },
        "inputs":{
          "parameters":{
            "exclude_splits":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"[]"
                }
              }
            }
          },
          "artifacts":{
            "schema":{
              "producerTask":"SchemaGen",
              "outputArtifactKey":"schema"
            },
            "statistics":{
              "outputArtifactKey":"statistics",
              "producerTask":"StatisticsGen"
            }
          }
        },
        "outputs":{
          "artifacts":{
            "anomalies":{
              "artifactType":{
                "instanceSchema":"title: tfx.ExampleAnomalies\ntype: object\nproperties:\n  span:\n    type: int\n    description: Span for an artifact.\n  split_names:\n    type: string\n    description: JSON-encoded list of splits for an artifact. Empty string means artifact has no split.\n"
              }
            }
          }
        },
        "cachingOptions":{

        }
      },
      {
        "outputs":{
          "artifacts":{
            "updated_analyzer_cache":{
              "artifactType":{
                "instanceSchema":"title: tfx.TransformCache\ntype: object\nproperties:\n"
              }
            },
            "transform_graph":{
              "artifactType":{
                "instanceSchema":"title: tfx.TransformGraph\ntype: object\nproperties:\n"
              }
            },
            "transformed_examples":{
              "artifactType":{
                "instanceSchema":"title: tfx.Examples\ntype: object\nproperties:\n  span:\n    type: int\n    description: Span for an artifact.\n  version:\n    type: int\n    description: Version for an artifact.\n  split_names:\n    type: string\n    description: JSON-encoded list of splits for an artifact. Empty string means artifact has no split.\n"
              }
            }
          }
        },
        "executorLabel":"Transform_executor",
        "cachingOptions":{

        },
        "taskInfo":{
          "name":"Transform"
        },
        "inputs":{
          "artifacts":{
            "examples":{
              "outputArtifactKey":"examples",
              "producerTask":"CsvExampleGen"
            },
            "schema":{
              "producerTask":"SchemaGen",
              "outputArtifactKey":"schema"
            }
          },
          "parameters":{
            "custom_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"null"
                }
              }
            },
            "force_tf_compat_v1":{
              "runtimeValue":{
                "constantValue":{
                  "intValue":"1"
                }
              }
            },
            "module_file":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"path/to/my/module_utils.py"
                }
              }
            }
          }
        },
        "dependentTasks":[
          "CsvExampleGen",
          "SchemaGen"
        ]
      },
      {
        "executorLabel":"Trainer_executor",
        "outputs":{
          "artifacts":{
            "model":{
              "artifactType":{
                "instanceSchema":"title: tfx.Model\ntype: object\nproperties:\n"
              }
            },
            "model_run":{
              "artifactType":{
                "instanceSchema":"title: tfx.ModelRun\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "cachingOptions":{

        },
        "dependentTasks":[
          "Resolver.latest_model_resolver",
          "SchemaGen",
          "Transform"
        ],
        "inputs":{
          "artifacts":{
            "base_model":{
              "producerTask":"Resolver.latest_model_resolver",
              "outputArtifactKey":"model"
            },
            "schema":{
              "producerTask":"SchemaGen",
              "outputArtifactKey":"schema"
            },
            "examples":{
              "producerTask":"Transform",
              "outputArtifactKey":"transformed_examples"
            },
            "transform_graph":{
              "producerTask":"Transform",
              "outputArtifactKey":"transform_graph"
            }
          },
          "parameters":{
            "module_file":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"path/to/my/module_utils.py"
                }
              }
            },
            "train_args":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"num_steps\": 10\n}"
                }
              }
            },
            "eval_args":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"num_steps\": 5\n}"
                }
              }
            },
            "custom_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"null"
                }
              }
            }
          }
        },
        "taskInfo":{
          "name":"Trainer"
        }
      },
      {
        "executorLabel":"Evaluator_executor",
        "taskInfo":{
          "name":"Evaluator"
        },
        "inputs":{
          "artifacts":{
            "model":{
              "producerTask":"Trainer",
              "outputArtifactKey":"model"
            },
            "baseline_model":{
              "outputArtifactKey":"model",
              "producerTask":"Resolver.latest_blessed_model_resolver-model-resolver"
            },
            "examples":{
              "producerTask":"CsvExampleGen",
              "outputArtifactKey":"examples"
            }
          },
          "parameters":{
            "eval_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"metrics_specs\": [\n    {\n      \"metrics\": [\n        {\n          \"class_name\": \"ExampleCount\"\n        }\n      ],\n      \"thresholds\": {\n        \"binary_accuracy\": {\n          \"change_threshold\": {\n            \"absolute\": -1e-10,\n            \"direction\": \"HIGHER_IS_BETTER\"\n          },\n          \"value_threshold\": {\n            \"lower_bound\": 0.5\n          }\n        }\n      }\n    }\n  ],\n  \"model_specs\": [\n    {\n      \"signature_name\": \"eval\"\n    }\n  ],\n  \"slicing_specs\": [\n    {},\n    {\n      \"feature_keys\": [\n        \"trip_start_hour\"\n      ]\n    }\n  ]\n}"
                }
              }
            },
            "example_splits":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"null"
                }
              }
            }
          }
        },
        "dependentTasks":[
          "CsvExampleGen",
          "Resolver.latest_blessed_model_resolver-model-resolver",
          "Trainer"
        ],
        "outputs":{
          "artifacts":{
            "evaluation":{
              "artifactType":{
                "instanceSchema":"title: tfx.ModelEvaluation\ntype: object\nproperties:\n"
              }
            },
            "blessing":{
              "artifactType":{
                "instanceSchema":"title: tfx.ModelBlessing\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "cachingOptions":{

        }
      },
      {
        "inputs":{
          "artifacts":{
            "model_blessing":{
              "outputArtifactKey":"blessing",
              "producerTask":"Evaluator"
            },
            "model":{
              "outputArtifactKey":"model",
              "producerTask":"Trainer"
            }
          },
          "parameters":{
            "custom_config":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"null"
                }
              }
            },
            "push_destination":{
              "runtimeValue":{
                "constantValue":{
                  "stringValue":"{\n  \"filesystem\": {\n    \"base_directory\": \"path/to/my/root/model_serving\"\n  }\n}"
                }
              }
            }
          }
        },
        "taskInfo":{
          "name":"Pusher"
        },
        "cachingOptions":{

        },
        "outputs":{
          "artifacts":{
            "pushed_model":{
              "artifactType":{
                "instanceSchema":"title: tfx.PushedModel\ntype: object\nproperties:\n"
              }
            }
          }
        },
        "dependentTasks":[
          "Evaluator",
          "Trainer"
        ],
        "executorLabel":"Pusher_executor"
      }
    ],
    "deploymentSpec":{
      "executors":{
        "Transform_executor":{
          "container":{
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ],
            "image":"tensorflow/tfx:latest",
            "args":[
              "--executor_class_path",
              "tfx.components.transform.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ]
          }
        },
        "Resolver.latest_model_resolver_executor":{
          "resolver":{
            "outputArtifactQueries":{
              "model":{
                "filter":"artifact_type='tfx.Model' and state=LIVE"
              }
            }
          }
        },
        "Resolver.latest_blessed_model_resolver-model-blessing-resolver_executor":{
          "resolver":{
            "outputArtifactQueries":{
              "model_blessing":{
                "filter":"artifact_type='tfx.ModelBlessing' and state=LIVE and custom_properties['blessed']='1'"
              }
            }
          }
        },
        "StatisticsGen_executor":{
          "container":{
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ],
            "args":[
              "--executor_class_path",
              "tfx.components.statistics_gen.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "image":"tensorflow/tfx:latest"
          }
        },
        "CsvExampleGen_executor":{
          "container":{
            "args":[
              "--executor_class_path",
              "tfx.components.example_gen.csv_example_gen.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "image":"tensorflow/tfx:latest",
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ],
            "lifecycle":{
              "preCacheCheck":{
                "command":[
                  "python",
                  "-m",
                  "tfx.orchestration.kubeflow.v2.file_based_example_gen.driver"
                ],
                "args":[
                  "--json_serialized_invocation_args",
                  "{{$}}"
                ]
              }
            }
          }
        },
        "SchemaGen_executor":{
          "container":{
            "image":"tensorflow/tfx:latest",
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ],
            "args":[
              "--executor_class_path",
              "tfx.components.schema_gen.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ]
          }
        },
        "Evaluator_executor":{
          "container":{
            "args":[
              "--executor_class_path",
              "tfx.components.evaluator.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "image":"tensorflow/tfx:latest",
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ]
          }
        },
        "Trainer_executor":{
          "container":{
            "image":"tensorflow/tfx:latest",
            "args":[
              "--executor_class_path",
              "tfx.components.trainer.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ]
          }
        },
        "Resolver.latest_blessed_model_resolver-model-resolver_executor":{
          "resolver":{
            "outputArtifactQueries":{
              "model":{
                "filter":"artifact_type='tfx.Model' and state=LIVE and name={$.inputs.artifacts['input'].custom_properties['current_model_id']}"
              }
            }
          }
        },
        "Pusher_executor":{
          "container":{
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ],
            "args":[
              "--executor_class_path",
              "tfx.components.pusher.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "image":"tensorflow/tfx:latest"
          }
        },
        "ExampleValidator_executor":{
          "container":{
            "image":"tensorflow/tfx:latest",
            "args":[
              "--executor_class_path",
              "tfx.components.example_validator.executor.Executor",
              "--json_serialized_invocation_args",
              "{{$}}"
            ],
            "command":[
              "python",
              "-m",
              "tfx.orchestration.kubeflow.v2.container.kubeflow_v2_run_executor"
            ]
          }
        }
      }
    }
  },
  "labels":{
    "tfx_py_version":"3-7",
    "tfx_runner":"kubeflow_v2",
    "tfx_version":"0-26-0-dev"
  },
  "runtimeConfig":{
    "gcsOutputDirectory":"path/to/my/root"
  }
}
